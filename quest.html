<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Quest of the Data Sensei</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet"/>
    
    <style>
        /* --- Root Variables Merged for Consistency --- */
        :root {
            /* Variables based on index(8).html (TikTok style) */
            --pink-neon: #FF7EB9; 
            --blue-neon: #73E8FF; 
            --dark: #212529;
            --light: #f8f9fa;

            /* Variables from quest.html */
            --neon-orange: #FF5C00; 
            
            /* Mapping variables */
            --dark-bg: var(--dark);
            --card-bg: #1e1e1e;
            --text-light: var(--light);
            --text-muted: #888;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-light);
            font-family: 'Roboto', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column; 
            justify-content: space-between;
            padding-top: 90px; /* Space for fixed navbar */
            padding-bottom: 0;
        }
        
        /* Wrapper to contain the game content and ensure it takes up vertical space */
        .adventure-container-wrapper {
             flex-grow: 1;
             display: flex;
             align-items: center; 
             justify-content: center;
             padding: 20px 0;
        }

        /* --- Navbar Styles from index(8).html --- */
        #navbar {
            background: var(--dark) !important; 
            border-bottom: 2px solid var(--pink-neon); 
        }
        #navbar .navbar-brand h1 {
            color: var(--blue-neon) !important; 
        }
        #navbar .nav-link {
            color: var(--blue-neon) !important; 
            font-weight: 700;
        }
        /* Active link uses pink neon */
        #navbar .nav-item .nav-link.active:not(.dropdown-item) {
            color: var(--pink-neon) !important; 
        }
        /* Hover link uses pink neon */
        #navbar .nav-item .nav-link:hover:not(.dropdown-item) {
            color: var(--pink-neon) !important; 
        }
        /* Dropdown styling */
        .dropdown-menu {
            background-color: var(--dark) !important;
            border: 1px solid var(--pink-neon) !important;
        }
        .dropdown-item {
            color: var(--blue-neon) !important;
        }
        .dropdown-item:hover, .dropdown-item:focus, .dropdown-item.active {
            background-color: var(--pink-neon) !important;
            color: var(--dark) !important;
        }
        /* Desktop dropdown hover functionality */
        @media (min-width: 992px) {
            .nav-item.dropdown:hover .dropdown-menu {
                display: block;
            }
            .nav-item.dropdown .nav-link {
                cursor: pointer;
            }
        }

        /* --- Footer Styles from index(8).html --- */
        .footer-container {
            background-color: var(--blue-neon) !important;
            color: var(--dark) !important;
        }
        .footer-container h4, .footer-container p, .footer-container a {
            color: var(--dark) !important;
        }
        .btn-social {
            border-radius: 50%;
            width: 42px;
            height: 42px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .footer-social a {
            border: 1px solid var(--dark); 
            color: var(--dark); 
            background: var(--light); 
        }
        .footer-social a:hover {
            background: var(--dark); 
            border-color: var(--light); 
            color: var(--light) !important; 
        }
        
        /* --- Original quest.html Game Styles (Retained) --- */
        .adventure-container {
            max-width: 900px;
            width: 100%;
            background-color: var(--card-bg);
            border: 2px solid var(--neon-orange);
            box-shadow: 0 0 15px var(--neon-orange);
            border-radius: 12px;
            padding: 40px 30px;
            text-align: center;
            margin: auto;
        }
        h1 {
            color: var(--neon-orange);
            font-weight: 700;
            /*text-shadow: 0 0 8px var(--neon-orange);*/
            margin-bottom: 25px;
        }
        .narrative {
            font-size: 1.15rem;
            margin-bottom: 30px;
            padding: 15px;
            border-left: 3px solid var(--blue-neon);
            text-align: left;
            background-color: rgba(0, 255, 255, 0.05);
        }
        .choice-btn {
            background-color: var(--card-bg);
            border: 1px solid var(--blue-neon);
            color: var(--text-light);
            padding: 15px 25px;
            margin: 10px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: block; 
            width: 100%;
            text-align: left;
        }
        .choice-btn:hover {
            background-color: var(--blue-neon);
            color: var(--dark-bg);
            box-shadow: 0 0 10px var(--blue-neon);
            transform: translateY(-2px);
            cursor: pointer;
        }
        /* Styling for the Novice option to make it distinct */
        .choice-btn.novice-choice {
            background-color: #333; /* Darker/Muted background */
            border-color: var(--text-muted);
            color: var(--text-muted);
            font-style: italic;
        }

        .choice-btn.novice-choice:hover {
            background-color: #555; 
            border-color: var(--text-light);
            color: var(--text-light);
            box-shadow: none;
        }


        .choice-btn i {
            margin-right: 15px;
            font-size: 1.2rem;
            color: var(--neon-orange);
            transition: color 0.3s ease;
        }
        
        .choice-btn.novice-choice i {
            color: var(--text-muted);
        }

        .choice-btn:hover i {
            color: var(--dark-bg);
        }
        .name-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--neon-orange);
            background-color: var(--dark-bg);
            color: var(--text-light);
            border-radius: 5px;
            text-align: center;
            font-size: 1.1rem;
        }
        .verdict-box {
            border: 2px dashed var(--neon-orange);
            padding: 25px;
            margin-top: 30px;
            border-radius: 8px;
            background-color: rgba(255, 92, 0, 0.05);
            text-align: left;
        }
        .verdict-box h2 {
            color: var(--blue-neon);
            margin-top: 0;
            border-bottom: 1px solid rgba(0, 255, 255, 0.3);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .skill-list li {
            margin-bottom: 10px;
        }
        .skill-list strong {
            color: var(--neon-orange);
        }
        .footer-buttons button,
        .footer-buttons a {
            font-weight: 700;
            margin: 0 10px;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            transition: all 0.3s ease;
            display: inline-block; 
            text-align: center; 
        }
        .retake-btn {
            background-color: var(--neon-orange);
            color: var(--dark-bg);
            border: 2px solid var(--neon-orange);
        }
        .retake-btn:hover {
            opacity: 0.8;
            box-shadow: 0 0 8px var(--neon-orange);
        }
        .index-btn {
            background-color: transparent;
            color: var(--blue-neon);
            border: 1px solid var(--blue-neon);
        }
        .index-btn:hover {
            background-color: var(--blue-neon);
            color: var(--dark-bg);
            box-shadow: 0 0 8px var(--blue-neon);
        }
        .intro-box {
            max-width: 500px; 
            margin: 0 auto;
        }
        .intro-box p.h4 {
            font-size: 1.15rem; 
            white-space: nowrap; 
            margin-left: auto;
            margin-right: auto;
        }
        .intro-box .retake-btn {
            display: block; 
            text-align: center; 
            padding-left: 0; 
            padding-right: 0;
            width: 100%;
        }
    </style>
</head>
<body data-spy="scroll" data-target="#navbar" data-offset="51">

<nav
  class="navbar fixed-top shadow-sm navbar-expand-lg navbar-dark py-3 py-lg-0 px-lg-5"
  id="navbar"
  style="display: block;" 
>
  <a href="index.html" class="navbar-brand d-block d-lg-none">
    <h1 class="m-0" style="color: var(--blue-neon) !important;">Roman's Portfolio</h1>
  </a>
  <button
    type="button"
    class="navbar-toggler"
    data-toggle="collapse"
    data-target="#navbarCollapse"
  >
    <span class="navbar-toggler-icon"></span>
  </button>
  <div
    class="collapse navbar-collapse justify-content-between"
    id="navbarCollapse"
  >
    <div class="navbar-nav m-auto">
        
        <div class="nav-item dropdown">
            <a href="index.html" class="nav-link" id="homeDropdown" aria-haspopup="true" aria-expanded="false">Home</a>
            <div class="dropdown-menu border-0 m-0" style="background-color: var(--dark);">
                <a href="index.html#home" class="dropdown-item nav-link" style="color: var(--blue-neon) !important;">Top of Page</a>
                <a href="index.html#about" class="dropdown-item nav-link" style="color: var(--blue-neon) !important;">About</a>
                <a href="index.html#skills" class="dropdown-item nav-link" style="color: var(--blue-neon) !important;">Skills</a>
                <a href="index.html#what-i-did" class="dropdown-item nav-link" style="color: var(--blue-neon) !important;">Project</a>
                <a href="index.html#teaching" class="dropdown-item nav-link" style="color: var(--blue-neon) !important;">Educator</a>
                <a href="index.html#connect" class="dropdown-item nav-link" style="color: var(--blue-neon) !important;">Contact</a>
            </div>
        </div>
        
        <a href="timeline.html" class="nav-item nav-link">Timeline</a>
        <a href="quiz.html" class="nav-item nav-link">Quiz</a>
        <a href="quest.html" class="nav-item nav-link active">Quest</a> </div>
  </div>
</nav>

<div class="adventure-container-wrapper">
    <div class="adventure-container">
        <h1>The Quest of the Data Sensei</h1>
        <div id="game-area">
            </div>
    </div>
</div>

<div class="container-fluid bg-secondary text-white mt-5 py-5 px-sm-3 px-md-5 footer-container">
    <div class="container text-center py-5">
        <h4 class="mb-4">Connect & Find My Content</h4>
        <div class="d-flex justify-content-center mb-4 footer-social">
            <a class="btn btn-social mx-2" href="https://www.linkedin.com/in/romansyasetyo" target="_blank"
               ><i class="fab fa-linkedin-in"></i
            ></a>
            <a class="btn btn-social mx-2" href="YOUR_INSTAGRAM_URL" target="_blank" title="Published soon"
               ><i class="fab fa-instagram"></i
            ></a>
            <a class="btn btn-social mx-2" href="YOUR_TIKTOK_URL" target="_blank" title="Published soon"
               ><i class="fab fa-tiktok"></i
            ></a>
            <a class="btn btn-social mx-2" href="https://www.youtube.com/@crazyrichdata" target="_blank"
               ><i class="fab fa-youtube"></i
            ></a>
        </div>
        <p class="m-0">
            &copy; <a class="font-weight-bold" href="#">Roman's Portfolio</a>. All Rights Reserved.
        </p>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.bundle.min.js"></script>
<script>
      // Script to make the Navbar toggler work on click for mobile
      $(document).ready(function () {
        $('#navbarCollapse a').on('click', function () {
          if ($(this).attr('href').startsWith('index.html#') || $(this).attr('href') === 'timeline.html' || $(this).attr('href') === 'quiz.html' || $(this).attr('href') === 'quest.html') {
            if ($(this).hasClass('nav-item') || $(this).hasClass('dropdown-item')) {
                if ($('.navbar-toggler').is(':visible')) {
                    $('.navbar-toggler').click();
                }
            }
          }
        });
      });
</script>

<script>
    // --- Game State Management ---
    let userName = '';
    let currentLayer = 0; // Start at 0 for the intro screen
    let pathHistory = {};
    let dominantPath = null; // Tachi (A), Kagami (B), Fude (C)
    let noviceChoiceCount = 0; // Tracks if the user picked the novice option

    const gameArea = document.getElementById('game-area');

    // Helper function to replace markdown bolding with strong tags
    const formatBold = (text) => text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

    // The universal novice choice object (Now leads to Layer 16)
    const noviceChoice = {
        id: 'Novice',
        text: "I am not sure. I admit this task is above my current expertise and request foundational guidance.",
        icon: 'fas fa-graduation-cap',
        nextLayer: 16 // Jumps to the start of the final Verdict Act
    };

    // --- Content Data Structure (Expanded to 18 Layers) ---
    // Mapping of choice IDs to specific skill tags for the final analysis.
    const skillTagMap = {
        // Tachi Path (A) - Layers 4, 5, 6, 7, 8, 10, 11, 12
        'A4.1': 'Highly-Engineered Features', 'A4.2': 'Auto-encoders/Raw Data Modeling',
        'A5.1': 'Complex XGBoost/LightGBM', 'A5.2': 'Interpretable LogReg',
        'A6.1': 'SHAP/LIME Explainability', 'A6.2': 'A/B Testing Simulation',
        'A7.1': 'Data Engineering Focus', 'A7.2': 'Simpler Neural Nets',
        'A8.1': 'PySpark/Dask Clustering', 'A8.2': 'Optuna/Hyperparameter Tuning',
        'A10.1': 'REST API/Microservice Deployment', 'A10.2': 'Batch Job Deployment',
        'A11.1': 'Data Drift/Model Degradation Alerts', 'A11.2': 'Manual Accuracy Reporting',
        'A12.1': 'Technical Readme/Wiki', 'A12.2': 'Business Retrospective',

        // Kagami Path (B) - Layers 4, 5, 6, 7, 8, 10, 11, 12
        'B4.1': 'Forced Non-Null Constraint', 'B4.2': 'K-NN Imputation (Data Repair)',
        'B5.1': 'Micro-batching (CDC)', 'B5.2': 'Daily Full Load/Merge',
        'B6.1': 'Great Expectations (Data Quality)', 'B6.2': 'User Acceptance Testing (UAT)',
        'B7.1': 'DWH Partitioning/Clustering', 'B7.2': 'Data Retention Policy',
        'B8.1': 'Materialized Views/DWH Optimization', 'B8.2': 'Cost-Benefit Analysis',
        'B10.1': 'Role-Based Access Control (RBAC)', 'B10.2': 'Data Masking/Tokenization (PII)',
        'B11.1': 'Unit/Integration Testing (Code Quality)', 'B11.2': 'Staging Environment Review',
        'B12.1': 'Technical Readme/Wiki', 'B12.2': 'Business Retrospective',

        // Fude Path (C) - Layers 4, 5, 6, 7, 8, 10, 11, 12
        'C4.1': 'N-gram Frequency/Word Clouds', 'C4.2': 'LLM/BERT Sentiment Scoring',
        'C5.1': 'Simple Funnel Chart', 'C5.2': 'Sankey Diagram (Flow Analysis)',
        'C6.1': 'Jupyter Notebook/Technical Report', 'C6.2': 'Single Executive Summary Slide',
        'C7.1': 'Simplified North Star KPI', 'C7.2': 'Stakeholder Workshop',
        'C8.1': 'Go-to-Market (GTM) Strategy', 'C8.2': 'Data Dictionary/Metric Taxonomy',
        'C10.1': 'Projected Return on Investment (ROI)', 'C10.2': 'Technical Feasibility Focus',
        'C11.1': 'Interactive Storytelling (D3.js/GSAP)', 'C11.2': 'Mantra/Catchphrase Communication',
        'C12.1': 'Technical Readme/Wiki', 'C12.2': 'Business Retrospective',
    };
    
    // Define layers that hold technical path choices (used for counting skill tags)
    const technicalLayers = [4, 5, 6, 7, 8, 10, 11, 12];


    const content = {
        0: { 
            buttonText: "Begin the Quest", 
            icon: 'fas fa-play'
        },
        1: {
            narrative: (name) => `Welcome, **${name}**. You stand before Ocha-Sensei, who offers you one of three legendary Data Artifacts. This choice dictates the focus of your trials.`,
            prompt: "Choose your primary discipline:",
            choices: [
                { id: 'A', text: "The **Tachi** (Long Sword): Predictive Modeling, MLOps, and algorithmic complexity.", icon: 'fas fa-hand-rock', nextLayer: 2 },
                { id: 'B', text: "The **Kagami** (Mirror): Data Architecture, Pipeline Robustness, and Data Governance.", icon: 'fas fa-shield-alt', nextLayer: 2 },
                { id: 'C', text: "The **Fude** (Brush): Storytelling, Insight Generation, and business translation.", icon: 'fas fa-feather-alt', nextLayer: 2 }
            ]
        },
        2: {
            A: { 
                narrative: (name) => `You chose the Tachi. The mission: build a system to predict user churn. **${name}**, which metric is the ultimate measure of your success?`,
                prompt: "Your Core Metric:",
                choices: [
                    { id: 'A2.1', text: "High **AUC-ROC Score** (Area Under the Curve) to prove model discrimination power.", nextLayer: 3 },
                    { id: 'A2.2', text: "**Precision** on the top 10% of high-risk users, ensuring business action targets the right people.", nextLayer: 3 }
                ]
            },
            B: { 
                narrative: (name) => `You chose the Kagami. The mission: build a highly scalable user retention pipeline. **${name}**, what is the single greatest concern for data quality?`,
                prompt: "Your Core Metric:",
                choices: [
                    { id: 'B2.1', text: "**Data Freshness** (low latency) from source to dashboard.", nextLayer: 3 },
                    { id: 'B2.2', text: "**Schema Stability** (no unexpected nulls or type changes) in the Data Warehouse.", nextLayer: 3 }
                ]
            },
            C: { 
                narrative: (name) => `You chose the Fude. The mission: deliver a compelling narrative on user retention loss. **${name}**, which business function is your key audience?`,
                prompt: "Your Core Metric:",
                choices: [
                    { id: 'C2.1', text: "The **Product Team**, to influence the development roadmap.", nextLayer: 3 },
                    { id: 'C2.2', text: "The **Executive Leadership**, to secure resource and budget approval.", nextLayer: 3 }
                ]
            }
        },
        3: {
            A: { 
                narrative: (name) => `A critical data source is on a vendor's S3 bucket, **${name}**. It's unstructured (JSON), heavy, and poorly documented. How do you approach this obstacle?`,
                prompt: "Your Data Environment Strategy:",
                choices: [
                    { id: 'A3.1', text: "Write a **Custom Python Script** to iteratively parse and flatten the JSON into a clean table structure.", nextLayer: 4 },
                    { id: 'A3.2', text: "Use a **Cloud ETL Tool** (e.g., Fivetran, Stitch) to handle the ingestion, trading control for speed.", nextLayer: 4 }
                ]
            },
            B: { 
                narrative: (name) => `A critical data source is on a vendor's S3 bucket, **${name}**. It's unstructured (JSON), heavy, and poorly documented. How do you approach this obstacle?`,
                prompt: "Your Data Environment Strategy:",
                choices: [
                    { id: 'B3.1', text: "Write a **Custom Python Script** to iteratively parse and flatten the JSON into a clean table structure.", nextLayer: 4 },
                    { id: 'B3.2', text: "Use a **Cloud ETL Tool** (e.g., Fivetran, Stitch) to handle the ingestion, trading control for speed.", nextLayer: 4 }
                ]
            },
            C: { 
                narrative: (name) => `A critical data source is on a vendor's S3 bucket, **${name}**. It's unstructured (JSON), heavy, and poorly documented. How do you approach this obstacle?`,
                prompt: "Your Data Environment Strategy:",
                choices: [
                    { id: 'C3.1', text: "Write a **Custom Python Script** to iteratively parse and flatten the JSON into a clean table structure.", nextLayer: 4 },
                    { id: 'C3.2', text: "Use a **Cloud ETL Tool** (e.g., Fivetran, Stitch) to handle the ingestion, trading control for speed.", nextLayer: 4 }
                ]
            }
        },
        4: { 
            A: { 
                narrative: (name) => `Speed is vital, **${name}**. For feature generation, time is short. Which path balances effort and data quality for a quick-hit model?`,
                prompt: "Your Tactical Data Prep Focus:",
                choices: [
                    { id: 'A4.1', text: "Create **Highly-Engineered Features** (e.g., custom rolling averages) on a small, clean data sample.", nextLayer: 5 },
                    { id: 'A4.2', text: "Use **All Raw Features** and auto-encoders on the full dataset, trusting the model to handle noise.", nextLayer: 5 },
                    noviceChoice
                ]
            },
            B: { 
                narrative: (name) => `The schema is weak, **${name}**. A key field for retention is missing 20% of the time. This must be fixed before any analysis begins.`,
                prompt: "Your Foundational Integrity Decision:",
                choices: [
                    { id: 'B4.1', text: "Implement a **Forced Non-Null Constraint** in the upstream ETL to block bad data.", nextLayer: 5 },
                    { id: 'B4.2', text: "Perform a **Backfill** using a statistical imputation method (e.g., K-Nearest Neighbors) to repair historical data.", nextLayer: 5 },
                    noviceChoice
                ]
            },
            C: { 
                narrative: (name) => `The whispers of 10,000 raw app reviews need to be heard, **${name}**. How do you begin to transform this noise into actionable context?`,
                prompt: "Your Insight Transformation Strategy:",
                choices: [
                    { id: 'C4.1', text: "Use **Simple N-gram Frequency and Word Clouds** to quickly identify trending keywords and themes.", nextLayer: 5 },
                    { id: 'C4.2', text: "Apply a **Pre-trained LLM/BERT Model** to derive immediate, granular sentiment and topic scoring.", nextLayer: 5 },
                    noviceChoice
                ]
            }
        },
        5: { 
            A: { 
                narrative: (name) => `Your features are set, **${name}**. We need max accuracy on a short timeline to identify at-risk users.`,
                prompt: "Your Model Selection:",
                choices: [
                    { id: 'A5.1', text: "Choose **Complex Gradient Boosting (XGBoost/LightGBM)** for maximum performance, accepting lower interpretability.", nextLayer: 6 },
                    { id: 'A5.2', text: "Choose **Interpretable Logistic Regression** to quickly confirm core drivers and get immediate business trust.", nextLayer: 6 },
                    noviceChoice
                ]
            },
            B: { 
                narrative: (name) => `The DWH is slow; the metric needs frequent updates. **${name}**, how do you balance cost and latency?`,
                prompt: "Your Data Load Strategy:",
                choices: [
                    { id: 'B5.1', text: "Implement **Micro-batches** (every 15 mins) using a change data capture (CDC) stream.", nextLayer: 6 },
                    { id: 'B5.2', text: "Rely on a **Daily Full Load/Merge** process to simplify pipeline logic and save immediate compute cost.", nextLayer: 6 },
                    noviceChoice
                ]
            },
            C: { 
                narrative: (name) => `You've processed the text, **${name}**. You must visualize the user drop-off process to show context, not just volume.`,
                prompt: "Your Visualization Strategy:",
                choices: [
                    { id: 'C5.1', text: "Use a simple **Funnel Chart** showing clear volume loss at each step.", nextLayer: 6 },
                    { id: 'C5.2', text: "Use a **Sankey Diagram** to show how users flow across various retention states before and after the drop-off event.", nextLayer: 6 },
                    noviceChoice
                ]
            }
        },
        6: { 
            A: { 
                narrative: (name) => `The model is built, **${name}**. Before deployment, you must validate its business relevance.`,
                prompt: "Your Validation Method:",
                choices: [
                    { id: 'A6.1', text: "Check **Feature Importance Scores (e.g., SHAP/LIME)** to confirm the model aligns with domain knowledge.", nextLayer: 7 },
                    { id: 'A6.2', text: "Propose an **Extensive A/B Test Simulation** using holdout data to measure projected ROI and impact.", nextLayer: 7 },
                    noviceChoice
                ]
            },
            B: { 
                narrative: (name) => `The new pipeline is running, **${name}**. How do you guarantee long-term data quality and trust?`,
                prompt: "Your Data Quality Assurance:",
                choices: [
                    { id: 'B6.1', text: "Implement a **Data-Profiling Tool (Great Expectations/dbt-expectations)** to automatically check schema, volume, and distribution.", nextLayer: 7 },
                    { id: 'B6.2', text: "Execute **User Acceptance Testing (UAT)** with the business and dashboard users to manually confirm reliability.", nextLayer: 7 },
                    noviceChoice
                ]
            },
            C: { 
                narrative: (name) => `You have a profound insight from the text data, **${name}**. How do you make it stick and drive immediate action from leadership?`,
                prompt: "Your Insight Delivery Focus:",
                choices: [
                    { id: 'C6.1', text: "Deliver a deep-dive **Jupyter Notebook/Technical Report** to the engineering team for technical feasibility.", nextLayer: 7 },
                    { id: 'C6.2', text: "Simplify the core finding into a **Single Executive Summary Slide** focused on the 'So What' and immediate next steps.", nextLayer: 7 },
                    noviceChoice
                ]
            }
        },
        7: { 
            A: { 
                narrative: (name) => `The complex model is powerful but takes 3 hours to train. It's too slow for daily updates, **${name}**. The mission demands speed.`,
                prompt: "Your Course Correction:",
                choices: [
                    { id: 'A7.1', text: "Focus on **Data Engineering** to pre-calculate all features and speed up the training pipeline.", nextLayer: 8 },
                    { id: 'A7.2', text: "Switch to a **Simpler Model (e.g., Simple Neural Net)** and invest time in feature selection/hyperparameter tuning.", nextLayer: 8 },
                    noviceChoice
                ]
            },
            B: { 
                narrative: (name) => `The new pipeline is robust, but the CFO flags the high DWH cost for the frequent loads, **${name}**. We need cost efficiency.`,
                prompt: "Your Cost-Saving Strategy:",
                choices: [
                    { id: 'B7.1', text: "Optimize **SQL Query Logic and DWH Partitioning/Clustering** to reduce expensive compute time.", nextLayer: 8 },
                    { id: 'B7.2', text: "Propose a **Change in Data Retention Policy** (Business decision) to minimize the volume of data stored.", nextLayer: 8 },
                    noviceChoice
                ]
            },
            C: { 
                narrative: (name) => `The C-suite misinterpreted your complex chart and is now focusing on the wrong feature, **${name}**. We need clarity, not complexity.`,
                prompt: "Your Communication Recovery:",
                choices: [
                    { id: 'C7.1', text: "Design a **Single, Simplified KPI (e.g., North Star Metric)** on the dashboard to align focus.", nextLayer: 8 },
                    { id: 'C7.2', text: "Hold a **30-minute Workshop** with key stakeholders to explain the full context and complexity of the finding.", nextLayer: 8 },
                    noviceChoice
                ]
            }
        },
        8: { 
            A: { 
                narrative: (name) => `The mission continues, **${name}**. Execute your chosen strategy to overcome the model's speed limitations.`,
                prompt: "Your Technical Task:",
                choices: [
                    { id: 'A8.1', text: "Write a high-performance **Pyspark/Dask** script to clean and aggregate features on a distributed cluster.", nextLayer: 9 },
                    { id: 'A8.2', text: "Re-write the model training to utilize **Optuna** or similar tools for rapid, automated hyperparameter optimization.", nextLayer: 9 },
                    noviceChoice
                ]
            },
            B: { 
                narrative: (name) => `The mission continues, **${name}**. Execute your chosen strategy to reduce pipeline cost without sacrificing integrity.`,
                prompt: "Your Technical Task:",
                choices: [
                    { id: 'B8.1', text: "Implement **Materialized Views/Clustering** in the DWH to pre-aggregate complex joins, reducing query costs for analysts.", nextLayer: 9 },
                    { id: 'B8.2', text: "Develop a **Cost-Benefit Analysis Report** on the current data retention and present alternative storage tiers.", nextLayer: 9 },
                    noviceChoice
                ]
            },
            C: { 
                narrative: (name) => `The mission continues, **${name}**. Execute your chosen strategy to restore confidence and action among leadership.`,
                prompt: "Your Technical Task:",
                choices: [
                    { id: 'C8.1', text: "Create a detailed **Go-to-Market (GTM) Strategy** document focused solely on the impact of the insight.", nextLayer: 9 },
                    { id: 'C8.2', text: "Develop a clear, comprehensive **Data Dictionary and Metric Taxonomy** to eliminate future confusion.", nextLayer: 9 },
                    noviceChoice
                ]
            }
        },
        9: { 
            narrative: (name) => `The pressure is immense, **${name}**. To find the strength for the final push, look ahead. Ocha-Sensei: 'What grand vision do you hold ontoâ€”the destination that awaits your victorious returnâ€”to re-ignite your focus?'`,
            prompt: "Your Motivation Choice (Choose your reward):",
            choices: [
                { id: 'A9.1', text: "The **Bustling City**: A week exploring the hyper-modern architecture and electric energy of Tokyo/Shinjuku.", icon: 'fas fa-city', nextLayer: 10 },
                { id: 'A9.2', text: "The **Ancient Temples**: A retreat to the serene, historical gardens and temples of Kyoto.", icon: 'fas fa-mountain', nextLayer: 10 }
            ]
        },
        10: { 
            A: { 
                narrative: (name) => `Your model is optimal, **${name}**. Now, we must make it production-ready and highly available for the application to consume in real-time.`,
                prompt: "Your Deployment Strategy:",
                choices: [
                    { id: 'A10.1', text: "Deploy as a **REST API/Microservice (Kubernetes/Managed Endpoint)** for low-latency, real-time scoring.", nextLayer: 11 },
                    { id: 'A10.2', text: "Deploy as a scheduled **Batch Job** that updates a simple DWH lookup table daily.", nextLayer: 11 },
                    noviceChoice
                ]
            },
            B: { 
                narrative: (name) => `The data is clean, **${name}**, but sensitive information is exposed. We need to secure the perimeter before wider release.`,
                prompt: "Your Data Governance Focus:",
                choices: [
                    { id: 'B10.1', text: "Implement **Role-Based Access Control (RBAC)** in the DWH to manage who can access what tables/columns.", nextLayer: 11 },
                    { id: 'B10.2', text: "Implement **Data Masking/Tokenization** for all Personally Identifiable Information (PII) at the source.", nextLayer: 11 },
                    noviceChoice
                ]
            },
            C: { 
                narrative: (name) => `The insight requires a major budget increase for a new team, **${name}**. You must secure the final buy-in from the C-suite.`,
                prompt: "Your Final Presentation Focus:",
                choices: [
                    { id: 'C10.1', text: "Focus on the **Projected Return on Investment (ROI)** and the massive business opportunity of the new project.", nextLayer: 11 },
                    { id: 'C10.2', text: "Focus on the **Technical Feasibility** and the low-risk/high-reward nature of the resource requirements.", nextLayer: 11 },
                    noviceChoice
                ]
            }
        },
        11: { 
            A: { 
                narrative: (name) => `The model is live, **${name}**. It's only a matter of time before its performance drifts. How do you monitor its health autonomously?`,
                prompt: "Your Monitoring Solution:",
                choices: [
                    { id: 'A11.1', text: "Set up automated **Data Drift/Model Degradation Alerts** using MLOps platforms (MLflow/SageMaker).", nextLayer: 12 },
                    { id: 'A11.2', text: "Develop a **Scheduled Report** that manually tracks model accuracy on a daily holdout test set.", nextLayer: 12 },
                    noviceChoice
                ]
            },
            B: { 
                narrative: (name) => `The pipeline is secured, **${name}**. The last piece is to embed quality checks into the code itself for maintainability.`,
                prompt: "Your Data Testing Method:",
                choices: [
                    { id: 'B11.1', text: "Implement **Unit Tests and Integration Tests** in your Python/SQL code to check logic pre-deployment.", nextLayer: 12 },
                    { id: 'B11.2', text: "Create a separate **Staging Environment** to manually review all new data changes before they hit production.", nextLayer: 12 },
                    noviceChoice
                ]
            },
            C: { 
                narrative: (name) => `The story must be told, **${name}**. The final presentation needs to be unforgettable and compelling.`,
                prompt: "Your Narrative Tool Choice:",
                choices: [
                    { id: 'C11.1', text: "Create an **Interactive Storytelling Dashboard** (D3.js/GSAP) focused on user journey and emotional impact.", nextLayer: 12 },
                    { id: 'C11.2', text: "Develop a **Simple, Repeated Mantra/Catchphrase** for the insight and distribute it via internal communication channels.", nextLayer: 12 },
                    noviceChoice
                ]
            }
        },
        12: {
            A: { 
                narrative: (name) => `The model is performing well. **${name}**, your final task for this project is documentation.`,
                prompt: "Your Documentation Style:",
                choices: [
                    { id: 'A12.1', text: "A highly **Technical Readme/Wiki** for engineers, detailing code, environment, and API specifications.", nextLayer: 13 },
                    { id: 'A12.2', text: "A **Business-Focused Project Retrospective** for stakeholders, detailing outcomes, impact, and assumptions.", nextLayer: 13 }
                ]
            },
            B: { 
                narrative: (name) => `The pipeline is robust. **${name}**, your final task for this project is documentation.`,
                prompt: "Your Documentation Style:",
                choices: [
                    { id: 'B12.1', text: "A highly **Technical Readme/Wiki** for engineers, detailing code, environment, and API specifications.", nextLayer: 13 },
                    { id: 'B12.2', text: "A **Business-Focused Project Retrospective** for stakeholders, detailing outcomes, impact, and assumptions.", nextLayer: 13 }
                ]
            },
            C: { 
                narrative: (name) => `The insight is clear and accepted. **${name}**, your final task for this project is documentation.`,
                prompt: "Your Documentation Style:",
                choices: [
                    { id: 'C12.1', text: "A highly **Technical Readme/Wiki** for engineers, detailing code, environment, and API specifications.", nextLayer: 13 },
                    { id: 'C12.2', text: "A **Business-Focused Project Retrospective** for stakeholders, detailing outcomes, impact, and assumptions.", nextLayer: 13 }
                ]
            }
        },

        // ðŸŒŸ ACT V: LEADERSHIP & FUTURE-PROOFING (Layers 13-15) ðŸŒŸ
        13: {
            narrative: (name) => `Ocha-Sensei: 'You've defeated the Yokai for now, **${name}**. But a true leader must prepare the next generation. Your team is struggling with tribal knowledge. How do you solidify their future growth?'`,
            prompt: "Your People & Process Strategy:",
            choices: [
                { id: 'A13', text: "Implement a **Mandatory Code Review & Pair Programming** policy to transfer technical knowledge and standardize quality.", nextLayer: 14 },
                { id: 'B13', text: "Establish a **Dedicated Mentorship Program** across the team and allocate 10% of analyst time solely for training and skill-sharing.", nextLayer: 14 }
            ]
        },
        14: {
            narrative: (name) => `The market is shifting, and the business needs a competitive edge. Your infrastructure needs a major overhaul to support new, experimental data sources. How do you pitch this necessary, high-risk change?`,
            prompt: "Your Innovation Strategy:",
            choices: [
                { id: 'A14', text: "Propose a **Small, High-Impact POC** (Proof of Concept) on the experimental data to demonstrate immediate potential ROI before full investment.", nextLayer: 15 },
                { id: 'B14', text: "Present a **Long-Term Technology Roadmap** detailing the technical debt and the guaranteed competitive advantage over the next 3 years.", nextLayer: 15 }
            ]
        },
        15: {
            narrative: (name) => `You are now a strategic partner. The Product and Engineering VPs disagree on the next quarter's feature priority, and data supports both sides. How do you lead the alignment?`,
            prompt: "Your Final Strategic Alignment Decision:",
            choices: [
                { id: 'A15', text: "Facilitate a **Data-Driven Decision Framework Workshop** to standardize how projects are scored based on mission alignment and effort.", nextLayer: 16 },
                { id: 'B15', text: "Use **Advanced Scenario Modeling** (e.g., Monte Carlo simulations) to quantify the potential business risk/reward of each VP's proposal.", nextLayer: 16 }
            ]
        },

        // ACT VI: The Verdict and Skill Map (Layers 16-18)
        16: {
            narrative: (name) => `You have secured the victory, **${name}**. The project is stable, the team is growing, and the strategic direction is clear. Ocha-Sensei: 'Your technical command is solid. Now, let us assess the true measure of a leader.'`,
            prompt: "The path is clear for the final promotion.",
            choices: [
                { id: 'Next', text: "Advance to The Final Test of Self-Mastery.", nextLayer: 17, icon: 'fas fa-arrow-alt-circle-right' }
            ]
        },
        17: {
            narrative: (name) => `Ocha-Sensei: 'A true master, **${name}**, does not simply wield tools. They command the organization. Which discipline is your next focus for personal growth?'`,
            prompt: "Your Final Soft Skill Focus:",
            choices: [
                { id: 'A17', text: "Focus on **Executive Communication & Storytelling**: Mastering the boardroom presentation and political landscape.", nextLayer: 18 },
                { id: 'B17', text: "Focus on **Engineering Leadership & Mentorship**: Growing from coder to architect of talent and systems.", nextLayer: 18 },
                { id: 'C17', text: "Focus on **Product Management & Business Strategy**: Understanding the market and driving the roadmap with data.", nextLayer: 18 }
            ]
        },
        18: {
            // Layer 18: The Final Verdict - Skill Mastery Map
            narrative: (name, path) => {
                
                const skillMaps = {
                    'A': { title: "Chief MLOps Architect (The Tachi Master)", icon: 'fas fa-hand-rock', defaultPrimarySkills: ["MLOps & Cloud Deployment", "Feature Engineering & Selection", "Model Monitoring & Drift Alerting"], advancedTool: "SHAP/LIME (Model Explainability)", softSkill: "Executive Communication & Storytelling", bonus: "A/B Testing and Experimental Design" },
                    'B': { title: "Principal Data Architect (The Kagami Master)", icon: 'fas fa-shield-alt', defaultPrimarySkills: ["Scalable Data Engineering (dbt/Airflow)", "DWH Optimization", "Data Governance & RBAC"], advancedTool: "Great Expectations (Data Quality)", softSkill: "Engineering Leadership & Mentorship", bonus: "Cost-Benefit Analysis & Financial Modeling" },
                    'C': { title: "Chief Insight Officer (The Fude Master)", icon: 'fas fa-feather-alt', defaultPrimarySkills: ["Advanced Text Analytics (LLMs/BERT)", "Data Storytelling & Interactive Visualization", "Metric Taxonomy & Data Dictionary Creation"], advancedTool: "D3.js/GSAP (Interactive Narrative)", softSkill: "Product Management & Business Strategy", bonus: "Go-to-Market Strategy & Business Planning" },
                    // Consolidated Novice Result
                    'Novice': { title: "Foundational Analyst (The Focused Student)", icon: 'fas fa-book', primarySkills: ["Mastering Foundational SQL", "Data Visualization and Communication", "Excel/Spreadsheet Modeling"], advancedTool: "Version Control (Git)", softSkill: "Self-Awareness & Scoping", bonus: "Data Ethics and Privacy Fundamentals" }
                };

                let result = skillMaps[path]; 
                
                // --- Priority 1: NOVICE OVERRIDE LOGIC ---
                if (noviceChoiceCount >= 2) {
                    result = skillMaps['Novice'];
                    result.title = "Foundational Analyst (The Focused Student)";
                    result.softSkill = "Self-Awareness & Scoping (Rewarded for consistent professional humility)";
                    // Use predefined Foundational Skills
                    result.primarySkills = result.primarySkills; 
                } else {
                    // --- Priority 2: PATH HISTORY ANALYSIS (Technical Skills) ---
                    const skillCounts = {};
                    technicalLayers.forEach(layer => {
                        const choiceId = pathHistory[layer];
                        if (choiceId && choiceId !== 'Novice') {
                            const tag = skillTagMap[choiceId];
                            if (tag) {
                                skillCounts[tag] = (skillCounts[tag] || 0) + 1;
                            }
                        }
                    });

                    // Convert skill counts to an array of [skill, count] pairs, sort by count descending
                    const sortedSkills = Object.entries(skillCounts)
                        .sort(([, countA], [, countB]) => countB - countA)
                        .map(([skill]) => skill); // Get just the skill name

                    // Use the top 3 chosen technical skills, falling back to default if not enough choices were technical
                    result.primarySkills = sortedSkills.slice(0, 3);
                    
                    // Fill in any remaining slots with the path's default skills
                    for (let i = result.primarySkills.length; i < 3; i++) {
                        // Find a default skill that hasn't been chosen/added yet
                        const defaultSkill = result.defaultPrimarySkills.find(d => !result.primarySkills.includes(d));
                        if (defaultSkill) {
                            result.primarySkills.push(defaultSkill);
                        }
                    }
                    
                    // --- Priority 3: SOFT SKILL ADJUSTMENT (Layer 17 & 1 Novice) ---
                    // Retrieve the soft skill from the final choice (Layer 17)
                    if (pathHistory[17]) {
                         const softSkillMap = {
                            'A17': 'Executive Communication & Storytelling',
                            'B17': 'Engineering Leadership & Mentorship',
                            'C17': 'Product Management & Business Strategy'
                        };
                        let layer17Choice = softSkillMap[pathHistory[17]];

                        // Adjust soft skill if 1 Novice was chosen
                        if (noviceChoiceCount === 1) {
                            result.softSkill = `Strategic Self-Awareness & Prudent Scoping, focused on ${layer17Choice}`;
                        } else {
                            result.softSkill = layer17Choice;
                        }
                    }
                }
                // --- END LOGIC ---

                // --- HTML Generation ---
                let html = `
                    <i class="${result.icon}" style="font-size: 3rem; color: var(--neon-orange); text-shadow: 0 0 5px var(--neon-orange);"></i>
                    <div class="verdict-box">
                        <h2>The Treasure: Your Skill Mastery Map</h2>
                        <p>Your journey is over, **${name}**. Ocha-Sensei meets you in the dojo and says: "You have shown the soul of a **${result.title}**. This map is forged from the thousands of micro-decisions you made when facing true chaos. It shows your path to mastery."</p>
                        
                        <h4>Ocha-Senseiâ€™s Top 3 Technical Recommendations:</h4>
                        <ul class="skill-list">
                            <li><strong>1. ${result.primarySkills[0] || result.defaultPrimarySkills[0]}:</strong> <em>Your most frequent technical decision led here.</em></li>
                            <li><strong>2. ${result.primarySkills[1] || result.defaultPrimarySkills[1]}:</strong> <em>Solidify this expertise to become indispensable.</em></li>
                            <li><strong>3. ${result.primarySkills[2] || result.defaultPrimarySkills[2]}:</strong> <em>A core strength you demonstrated mastery in.</em></li>
                        </ul>
                        
                        <h4>Mastery Tool & Soft Skill Focus:</h4>
                        <ul class="skill-list" style="margin-top: -10px;">
                            <li><strong>Advanced Tool/Tech:</strong> <em>Master the art of **${result.advancedTool}** to forge your weapon.</em></li>
                            <li><strong>Crucial Soft Skill:</strong> <em>Your organizational strength lies in **${result.softSkill}**.</em></li>
                        </ul>

                        <h4>Future Discipline (Bonus):</h4>
                        <ul class="skill-list" style="margin-top: -10px;">
                            <li><strong>Next Secret Discipline:</strong> <em>**${result.bonus}** is the key to true Sensei status.</em></li>
                        </ul>
                    </div>`;
                return html;
            }
        }
    };

    // --- Game Logic Functions ---

    function startGame() {
        userName = '';
        currentLayer = 0;
        pathHistory = {};
        dominantPath = null;
        noviceChoiceCount = 0; // Reset novice counter
        renderLayer(0);
    }

    function renderLayer(layerNum) {
        let layerData = content[layerNum];
        let html = '';
        const name = userName || 'Analyst';
        
        // Logic to select the correct branch based on dominantPath
        if (dominantPath) {
            // Checks if the current layer has branches (A, B, C)
            if (layerData[dominantPath] && typeof layerData[dominantPath] === 'object') {
                layerData = layerData[dominantPath];
            }
        }
        
        // --- Layer 0: Name Input Screen ---
        if (layerNum === 0) {
            html += `
                <div class="intro-box">
                    <p class="h4 my-4" style="color: var(--neon-blue);">Enter your name to accept the mission from Ocha-Sensei.</p>
                    <input type="text" id="name-input" class="name-input" placeholder="Your Name" value="${userName}" autofocus />
                    <button class="retake-btn btn" style="width: 100%; border: none; margin-top: 15px;" onclick="handleNameInput()"><i class="${layerData.icon}"></i> ${layerData.buttonText}</button>
                </div>
            `;
            gameArea.innerHTML = html;
            document.getElementById('name-input').focus();
            currentLayer = layerNum;
            return;
        }

        // --- Narrative Section (Layers 1-18) ---
        if (layerNum > 0) {
            let narrativeText = layerData.narrative;
            
            if (typeof narrativeText === 'function') {
                narrativeText = narrativeText(name, dominantPath);
            }
            
            // Render the narrative, replacing **text** with <strong>text</strong>
            html += `<div class="narrative">${formatBold(narrativeText)}</div>`;
        }

        // --- Prompt and Choices ---
        html += `<h3>${layerData.prompt}</h3>`;
        html += `<div class="row justify-content-center mt-4">`;

        layerData.choices.forEach(choice => {
            const icon = choice.icon || 'fas fa-code';
            const choiceId = choice.id;
            
            // Determine the click handler parameters
            let next = choice.nextLayer || layerNum + 1;
            let clickHandler = `handleChoice('${choiceId}', ${next})`;

            // Apply specific class for the novice choice
            const buttonClass = (choiceId === 'Novice') ? 'choice-btn novice-choice' : 'choice-btn';

            // Correctly format the choice text
            const formattedText = formatBold(choice.text);

            html += `
                <div class="col-md-6 mb-3">
                    <button class="${buttonClass}" onclick="${clickHandler}">
                        <i class="${icon}"></i> ${formattedText}
                    </button>
                </div>`;
        });
        html += `</div>`;

        gameArea.innerHTML = html;
        currentLayer = layerNum;
    }
    
    function handleNameInput() {
        const inputElement = document.getElementById('name-input');
        const name = inputElement.value.trim();
        if (!name) {
            alert("Ocha-Sensei requires a name to begin the mission.");
            return;
        }
        userName = name;
        renderLayer(1); // Move to Layer 1 (First narrative/choice)
    }

    function handleChoice(choiceId, nextLayer) {
        // 1. Set the dominant path on Layer 1 choice
        if (currentLayer === 1) {
            dominantPath = choiceId; // Set the main path (A, B, or C)
        }
        
        // 2. Handle the Novice Choice Logic
        if (choiceId === 'Novice') {
            noviceChoiceCount++; // Increment counter
            pathHistory[currentLayer] = choiceId;
            // The Novice button now consistently skips to Layer 16 (Consolidation/Pre-Verdict)
            if (currentLayer < 16) {
                nextLayer = 16;
            } else {
                nextLayer = 18; // If at L16 or L17 and choose Novice, go straight to verdict.
            }
        } else {
            // 3. Record the choice for non-Novice options
            pathHistory[currentLayer] = choiceId;
        }
        
        // 4. Move to next layer or final verdict
        if (nextLayer === 18) {
            renderVerdict();
        } else {
            renderLayer(nextLayer);
        }
    }

    function renderVerdict() {
        const name = userName;
        const finalPath = dominantPath;
        
        // Layer 18 is the verdict layer
        let html = content[18].narrative(name, finalPath);

        // Render the verdict, replacing **text** with <strong>text</strong>
        html = formatBold(html);

        // Add the final buttons
        html += `
        <div class="footer-buttons mt-5">
            <button class="btn retake-btn" onclick="startGame()"><i class="fas fa-redo-alt"></i> Retake The Quest</button>
            <a href="index.html" class="btn index-btn"><i class="fas fa-home"></i> Return to Main Page</a>
        </div>`;

        gameArea.innerHTML = html;
    }

    // Initialize the game
    startGame();
</script>

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
</body>
</html>
